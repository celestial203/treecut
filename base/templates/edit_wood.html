{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Edit Wood Record</h2>
            <a href="{% url 'wood_records' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                Back to List
            </a>
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Basic Information -->
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" name="name" value="{{ wood.name }}" class="form-input mt-1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Type</label>
                    <input type="text" name="type" value="{{ wood.type }}" class="form-input mt-1">
                </div>
            </div>

            <!-- Additional Information -->
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">WPP Number</label>
                    <input type="text" name="wpp_number" value="{{ wood.wpp_number }}" class="form-input mt-1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Business</label>
                    <input type="text" name="business" value="{{ wood.business }}" class="form-input mt-1" required>
                </div>
            </div>

            <!-- Plant and Measurements -->
            <div class="grid grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Plant</label>
                    <input type="text" name="plant" value="{{ wood.plant }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">DRC (cu.m)</label>
                    <input type="number" step="0.01" name="drc" value="{{ wood.drc }}" class="form-input mt-1" onchange="calculateALR()" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">ALR (m³)</label>
                    <input type="number" step="0.01" name="alr" value="{{ wood.alr }}" class="form-input mt-1" readonly>
                </div>
            </div>

            <!-- Location Information -->
            <div class="grid grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Location</label>
                    <input type="text" name="supplier_info" value="{{ wood.supplier_info }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Latitude</label>
                    <input type="number" step="0.000001" name="latitude" value="{{ wood.latitude }}" class="form-input mt-1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Longitude</label>
                    <input type="number" step="0.000001" name="longitude" value="{{ wood.longitude }}" class="form-input mt-1">
                </div>
            </div>

            <!-- Volume Information -->
            <div class="grid grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Local Volume</label>
                    <input type="number" step="0.001" name="local_volume" value="{{ wood.local_volume }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Imported Volume</label>
                    <input type="number" step="0.001" name="imported_volume" value="{{ wood.imported_volume }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Area (ha)</label>
                    <input type="number" step="0.01" name="area" value="{{ wood.area }}" class="form-input mt-1" required>
                </div>
            </div>

            <!-- Dates -->
            <div class="grid grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Date Issued</label>
                    <input type="date" name="date_issued" value="{{ wood.date_issued|date:'Y-m-d' }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Date Released</label>
                    <input type="date" name="date_released" value="{{ wood.date_released|date:'Y-m-d' }}" class="form-input mt-1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Expiry Date</label>
                    <input type="date" name="expiry_date" value="{{ wood.expiry_date|date:'Y-m-d' }}" class="form-input mt-1" required>
                </div>
            </div>

            <!-- Status and Approval -->
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Status</label>
                    <select name="wood_status" class="form-input mt-1" required>
                        <option value="EXISTING" {% if wood.wood_status == 'EXISTING' %}selected{% endif %}>Existing</option>
                        <option value="EXPIRED" {% if wood.wood_status == 'EXPIRED' %}selected{% endif %}>Expired/Renewed</option>
                        <option value="ACTIVE_NEW" {% if wood.wood_status == 'ACTIVE_NEW' %}selected{% endif %}>Active/New</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Approved By</label>
                    <input type="text" name="approved_by" value="{{ wood.approved_by }}" class="form-input mt-1" required>
                </div>
            </div>

            <!-- File Attachment -->
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700">Attachment</label>
                {% if wood.attachment %}
                    <p class="text-sm text-gray-600 mb-2">Current file: {{ wood.attachment.name }}</p>
                {% endif %}
                <input type="file" name="attachment" class="form-input mt-1">
            </div>

            <!-- Submit Buttons -->
            <div class="flex justify-end space-x-4 mt-6">
                <button type="button" onclick="window.history.back()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded">
                    Cancel
                </button>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function calculateALR() {
        const drcInput = document.querySelector('input[name="drc"]');
        const alrInput = document.querySelector('input[name="alr"]');
        
        if (drcInput && drcInput.value) {
            const drc = parseFloat(drcInput.value);
            // Formula: DRC × 290 × 0.80
            const alr = (drc * 290 * 0.80).toFixed(2);
            alrInput.value = alr;
        } else if (alrInput) {
            alrInput.value = '';
        }
    }

    // Calculate ALR on page load
    document.addEventListener('DOMContentLoaded', calculateALR);
</script>
{% endblock %}
